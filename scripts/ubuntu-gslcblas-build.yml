image: ubuntu/18.04
packages:
  # xorg-dev can be used instead of the detailed list of x11 libraries
  # fuse needed to create appimage
  [python3-pip, fuse, make, ninja-build, pkg-config, libx11-dev, libxext-dev, libxrandr-dev, libxrender-dev, libxcursor-dev, libxfixes-dev, libxi-dev, libxft-dev, gcc, g++]
sources:
  - https://github.com/franko/gsl-shell
  - https://github.com/franko/lhelper
shell: true
tasks:
  - enable-local: |
      echo 'export PATH="$HOME/.local/bin:$PATH"' >> "$HOME/.buildenv"
  - prepare-setup: |
      pip3 install --user meson
  - lhelper-install: |
      cd lhelper
      bash install "$HOME/.local"
  - lhelper-create-env: |
      lhelper create gsl-shell -n
      source "$(lhelper env-source gsl-shell)"
      lhelper install fox -xft
  - build: |
      cd gsl-shell
      source "$(lhelper env-source gsl-shell)"

      bash scripts/build-package.sh -unix
      bash scripts/repackage-appimage.sh gsl-shell-gslcblas-linux-x86_64.tar.gz
artifacts:
  - gsl-shell/gsl-shell-gslcblas-linux-x86_64.tar.gz
  - gsl-shell/GSLShell-gslcblas-x86_64.AppImage

